import string
import subprocess
from flask import Flask, Response, render_template, request
import fio
import os

app = Flask(__name__)
app.config["TEMPLATES_AUTO_RELOAD"] = True


def get_content(fname: str | None) -> str:
    if fname:
        if not fname.endswith(".txt") or any(
            c in fname for c in string.punctuation.replace(".", "")
        ):
            return "can't do!"

        try:
            return "".join(map(lambda x: x.decode(), fio.read_file("files/" + fname)))
        except:
            return "error occured, not found?"
    return ""


@app.route("/")
def getfile():
    files = subprocess.check_output(["ls", "files"]).decode()
    fname = request.args.get("fname")
    return render_template(
        "index.html",
        files=files,
        content=get_content(fname),
    )

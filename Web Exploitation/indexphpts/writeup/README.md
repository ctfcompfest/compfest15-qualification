# index.php.ts

> NOTE: This writeup is written with Chrome in mind, though it should not be very different with Firefox or any other browsers.

This is written in the experimental (or at least, when this writeup is written) Next.js App Router. It uses server actions, which can be seen in `AskBox` and `QuestionBox`.

It is easy to spot that there is SQL injection in `answerQuestion()` in the `actions.ts` file. Specifically, the `id` attribute is not escaped, just concatenated. Therefore that is our point of attack.

Looking at the client code, this server actions function is used in `QuestionBox`, when it is an admin. If the code was written correctly, this should be an impossible state, and would not be part of the bundle, since `isAdmin` is always `false` (See `page.tsx`). However, since the code calls some methods in it, the block will always be included in the result.

To see the code block, you are recommended to use React DevTools. You can hover into that component, and see the code.

![](https://i.imgur.com/zLXsGXt.png)

![](https://i.imgur.com/aWqCYdb.png)

As highlighted, the function `s(e)` is our `QuestionBox`. Scroll down a little bit, and we see our familiar `form` that contains the server action logic. See screenshot below.

![](https://i.imgur.com/FNAgR7Y.png)

Now, we just need to call the function. To do that, we can put a breakpoint somewhere inside the `s(e)` function, then export the `a.T` variable into global variable, since that is the server function (might be different with your local instance, or with actual deployed challenge)

After we have the function as variable, we can call it just like how we do in SQL injection attacks:

`await temp1("aa", 'a";INSERT INTO flag_owner VALUES("YOUR_UID_HERE");--')`

> NOTE: UID can be retrieved in `Application > Storage > Cookies > CHALL_URL`.

Refresh, the page, and we get our flag!

// gcc chall.c -o chall -fno-stack-protector -no-pie
#include <stdio.h>
#include <string.h>
#include <unistd.h>

void setup() {
    setvbuf(stdin, NULL, _IONBF, 0);
    setvbuf(stdout, NULL, _IONBF, 0);
    setvbuf(stderr, NULL, _IONBF, 0);
}

void readn(char *ptr, int size) {
  for (; size >= 0; --size, ++ptr) {
    read(0, ptr, 1);
    if (*ptr == '\n') break;
  }
}

int main()
{
    setup();
    char receiver[0x18];
    char *message = alloca(0x80);
    
    write(1,"Welcome to Short Message Sender!\n",34);
    write(1,"Send a message to: ",19);
    readn(receiver, 0x18);

    write(1,"Message to send: ",17);
    readn(message, 0x80);
    write(1,"Message sent!\n",14);

    return 0;
}